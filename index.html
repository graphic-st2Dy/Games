<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brain-GameZ</title>
<link rel="icon" type="image/png" href="icon.png">
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #161824;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    overflow: hidden;
  }

  h1 { position: absolute; left: 5%; bottom: 2%; font-size: 16px; }
  #score, #timer, #best { margin: 0 20px; font-size: 18px; font-weight: 300; text-align: center; }
  #gameArea { position: relative; flex: 1; width: 100%; display: block; }

  #timer {
   font-size: 32px; 
  }
  
  .numberBtn {
    position: absolute;
    width: 75px;
    height: 75px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 35px;
    border: 2px solid black;
    border-radius: 12px; /* soft rounded corners */
    cursor: none;
  }

  .numberBtn span {
    display: block;
    transform: rotate(0deg);
    color: black;
    font-weight: bold;
  }

  #playBtn {
    margin: 90% 0 0 0;
    padding: 12px 35px;
    font-size: 25px;
    border-radius: 12px;
    border: none;
    cursor: none;
    background-color: #30AF45;
    color: white;
  }

  .superText {
    position: absolute;
    left: 50%;
    top: 20%;
    transform: translate(-50%, -50%);
    font-size: 42px;
    font-weight: bold;
    opacity: 0;
    pointer-events: none;
    transition: all 0.8s ease;
    white-space: nowrap;
    text-shadow: 0 0 10px black, 0 0 20px black;
  }
  
  /* Fullscreen dark overlay */
#tutorialOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7); /* dark transparent background */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999; /* on top of everything */
}

/* The text box */
.tutorial-box {
  background: white;
  color: black;
  padding: 20px;
  width: 80%;
  max-width: 350px;
  border-radius: 15px;
  text-align: center;
  box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
}
  #closeTutorial {
    font-size: 1.2rem;
    padding: 2px 16px;
    border: 1px solid black;
    border-radius: 4px;
  }
</style>
</head>
<body>

  <div id="tutorialOverlay">
  <div class="tutorial-box">
    <h2>How to Play</h2>
    <p>Tap the buttons from the lowest to highest numbers to get a score</p>
    <button id="closeTutorial">Ok</button>
  </div>
</div>

<div id="game">
  <!-- Your game elements -->
</div>
  
<h1 style="font-weight: 700;">Brain<span style="color: #ff9900;">Game<span style="font-size: 26px; font-weight: 900; color: #ffbb22; text-shadow: 0 0 6px #ff9900;">z</span></span></h1>
  <div style="width: 100%; display: flex; justify-content: space-between; margin-top: 15px;">
  <div id="score">Score: 0</div>
  <div id="timer">Time: 100</div>
  <div id="best">Best: 0</div>
  </div>
    
<button id="playBtn">Play</button>
<div id="gameArea"></div>
<div id="superText" class="superText"></div>

<!-- Audio Elements -->
<audio id="bgMusic" loop preload="auto"></audio>
<audio id="clickSound" preload="auto"></audio>
<audio id="scoreSound" preload="auto"></audio>
<audio id="loseSound" preload="auto"></audio>
<script>
const playBtn = document.getElementById('playBtn');
const gameArea = document.getElementById('gameArea');
const scoreDisplay = document.getElementById('score');
const bestScoreDisplay = document.getElementById('best');
const timerDisplay = document.getElementById('timer');
const superText = document.getElementById('superText');

const bgMusic = document.getElementById('bgMusic');
const clickSound = document.getElementById('clickSound');
const scoreSound = document.getElementById('scoreSound');
const loseSound = document.getElementById('loseSound');

  
// Set your audio file paths here:
bgMusic.src = 'bgMusic.mp3';

   
  // Check if user is new
const firstTime = localStorage.getItem("firstTimePlayer");

const overlay = document.getElementById("tutorialOverlay");
const game = document.getElementById("game");
const closeBtn = document.getElementById("closeTutorial");

// If first time, show overlay
if (!firstTime) {
  overlay.style.display = "flex"; // show
  game.style.filter = "blur(0px)";
} else {
  overlay.style.display = "none"; // hide
}

// When user closes tutorial
closeBtn.onclick = () => {
  localStorage.setItem("firstTimePlayer", "true");
  overlay.style.display = "none";
};
  
  
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
        bgMusic.pause();     // When tab is hidden
    } else {
        bgMusic.play();      // When user comes back
    }
});
  
  
let score = 0;
let best = 0;
let numbers = [];
let expectedOrder = [];
let timer = 100;
let timerInterval = null;
let gameActive = false;

const MIN_GAP = 20; 
const BTN_SIZE = 60;

function randomLightColor() {
  const r = Math.floor(Math.random() * 155 + 100);
  const g = Math.floor(Math.random() * 155 + 100);
  const b = Math.floor(Math.random() * 155 + 100);
  return `rgb(${r},${g},${b})`;
}

function generateUniqueNumbers(count, maxValue) {
  const nums = new Set();
  while(nums.size < count) {
    const val = Math.floor(Math.random() * maxValue);
    nums.add(val);
  }
  return Array.from(nums);
}

function generateNumbers() {
  numbers.forEach(n => n.btn.remove());
  numbers = [];
  expectedOrder = [];

  const count = Math.min(2 + Math.floor(score / 5), 10);
  const uniqueValues = generateUniqueNumbers(count, 2 + score);

  for (let i = 0; i < count; i++) {
    const value = uniqueValues[i];
    const btn = document.createElement('button');
    btn.classList.add('numberBtn');
    const span = document.createElement('span');
    span.textContent = value;
    btn.appendChild(span);
    btn.style.backgroundColor = randomLightColor();

    const areaWidth = gameArea.clientWidth;
    const areaHeight = gameArea.clientHeight;

    let x, y, z, safe;
    let attempts = 0;
    do {
      x = Math.random() * (areaWidth - 2 * BTN_SIZE);
      y = Math.random() * (areaHeight - 2 * BTN_SIZE);
      z = 100 - value;
      safe = true;
      for (let n of numbers) {
        const dx = Math.abs(n.x - x);
        const dy = Math.abs(n.y - y);
        if (dx < BTN_SIZE + MIN_GAP && dy < BTN_SIZE + MIN_GAP) {
          safe = false;
          break;
        }
      }
      attempts++;
      if(attempts > 100) break;
    } while(!safe);

    btn.style.left = x + 'px';
    btn.style.top = y + 'px';
    btn.style.zindex = z + 'px';

    btn.onclick = () => checkNumber(btn, value);

    gameArea.appendChild(btn);
    numbers.push({btn, value, x, y, z, angle: 0});
  }

  expectedOrder = numbers.map(n => n.value).sort((a,b)=>a-b);
}

function animate() {
  if(!gameActive) return;
  numbers.forEach(n => {
    n.angle += 0.9;
    n.btn.style.transform = `rotate(${n.angle}deg)`;
    n.btn.firstChild.style.transform = `rotate(${-n.angle}deg)`;
  });
  requestAnimationFrame(animate);
}

  let mlet = 400;
  
function showSuperText(text, color, time1) {
  superText.textContent = text;
  superText.style.color = color;
  superText.style.opacity = '1';
  superText.style.transform = 'translate(-50%, -80%)';
  setTimeout(() => {
    superText.style.opacity = '0';
    superText.style.transform = 'translate(-50%, -120%)';
  }, time1);
}

function checkNumber(button, value) {
  if(!gameActive) return;
  let clickSound = new Audio('click1.mp3');
  clickSound.play();
// button click sound
  // pop-out animation
  button.style.transform = 'scale(1.3)';
  button.style.transform = 'rotate(0), scale(1.5)';
  button.firstChild.style.transform = 'rotate(0)';
  setTimeout(() => button.style.transform = 'scale(1)', 100);

  if(value === expectedOrder[0]) {
    setTimeout(() => button.remove() , 100);
    expectedOrder.shift();
    if(expectedOrder.length === 0) {
      score++ ;
      if (score >= best) { best = score;}
      scoreDisplay.textContent = "Score: " + score;
      bestScoreDisplay.textContent = "Best: " + best;
      timer += 1;
       let scoreSound = new Audio('score.mp3');
       scoreSound.volume = 0.25;
       scoreSound.play(); // score sound
      const positiveWords = ["Great!", "Perfect!", "Nice!", "Awesome!", "Well Done!"];
      const msg = positiveWords[Math.floor(Math.random() * positiveWords.length)];
      showSuperText(msg, 'white', 400);
      generateNumbers();
    }
  } else {
    showSuperText("You Lost!", 'red', 1200);
    let loseSound = new Audio('lose.mp3');
    loseSound.volume = 0.5;
  loseSound.play(); // lose sound
    gameOver();
  }
}

function gameOver() {
  gameActive = false;
  clearInterval(timerInterval);
  setTimeout(() => startGame(), 1000); // auto restart
}

function startGame() {
  playBtn.style.display = 'none';
  if(bgMusic.paused) bgMusic.play(); // start background music
  score = 0;
  scoreDisplay.textContent = "Score: 0";
  timer = 100;
  timerDisplay.textContent = "Time: " + timer;
  generateNumbers();

  gameActive = true;
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if(!gameActive) return;
    timer--;
    timerDisplay.textContent = "Time: " + timer;
    if(timer <= 0) {
      showSuperText("You Lost!", 'red');
      let loseSound = new Audio('lose.mp3');
      loseSound.volume = 0.4;
  loseSound.play();
      gameOver();
    }
  }, 1000);

  animate();
}

playBtn.onclick = startGame;
</script>

</body>
</html>